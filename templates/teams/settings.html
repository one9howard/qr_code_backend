{% extends "base.html" %}

{% block title %}Team Settings | {{ team.name }}{% endblock %}

{% block content %}
<div class="glass-card" style="max-width: 1100px; margin: 24px auto; padding: 24px;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
        <div>
            <h1 style="margin: 0;">Team Settings</h1>
            <p style="margin: 6px 0 0; color: var(--text-muted);">{{ team.name }}</p>
        </div>
        <a class="btn-secondary" href="{{ url_for('teams.team_dashboard', team_id=team.id) }}">Back to Team</a>
    </div>

    <div style="display: grid; grid-template-columns: repeat(2, minmax(260px, 1fr)); gap: 16px; margin-top: 20px;">
        <div class="glass-card" style="padding: 14px;">
            <h2 style="margin-top: 0;">Retention</h2>
            <form method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="action" value="set_retention">
                <label for="retention_days" style="display: block; margin-bottom: 8px;">Retention days (7-365)</label>
                <input id="retention_days" name="retention_days" type="number" min="7" max="365" value="{{ team.retention_days }}" required>
                <button class="btn-primary" type="submit" style="margin-top: 8px;">Update Retention</button>
            </form>
        </div>

        <div class="glass-card" style="padding: 14px;">
            <h2 style="margin-top: 0;">Invite Member</h2>
            <form method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="action" value="invite_member">
                <label for="email" style="display: block; margin-bottom: 8px;">Email</label>
                <input id="email" name="email" type="email" required>
                <label for="role" style="display: block; margin: 10px 0 8px;">Role</label>
                <select id="role" name="role">
                    <option value="viewer">Viewer</option>
                    <option value="member">Member</option>
                </select>
                <button class="btn-primary" type="submit" style="margin-top: 10px;">Create Invite</button>
            </form>
            {% if created_invite_url %}
            <div style="margin-top: 12px; font-size: 0.9rem;">
                <div style="color: var(--text-muted); margin-bottom: 4px;">Invite link</div>
                <code style="word-break: break-all;">{{ created_invite_url }}</code>
            </div>
            {% endif %}
        </div>
    </div>

    <div style="margin-top: 24px;">
        <h2>Members</h2>
        {% if members %}
        <div class="glass-card" style="padding: 0; overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align: left; background: rgba(255,255,255,0.04);">
                        <th style="padding: 10px;">User</th>
                        <th style="padding: 10px;">Role</th>
                        <th style="padding: 10px;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in members %}
                    <tr style="border-top: 1px solid rgba(255,255,255,0.08);">
                        <td style="padding: 10px;">{{ member.full_name or member.email }}</td>
                        <td style="padding: 10px;">{{ member.role|title }}</td>
                        <td style="padding: 10px;">{{ member.status|title }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="glass-card" style="padding: 12px; color: var(--text-muted);">No members found.</div>
        {% endif %}
    </div>

    <div style="margin-top: 24px;">
        <h2>Invites</h2>
        {% if invites %}
        <div class="glass-card" style="padding: 0; overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align: left; background: rgba(255,255,255,0.04);">
                        <th style="padding: 10px;">Email</th>
                        <th style="padding: 10px;">Role</th>
                        <th style="padding: 10px;">Expires</th>
                        <th style="padding: 10px;">Status</th>
                        <th style="padding: 10px;">Link</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invite in invites %}
                    <tr style="border-top: 1px solid rgba(255,255,255,0.08);">
                        <td style="padding: 10px;">{{ invite.email }}</td>
                        <td style="padding: 10px;">{{ invite.role|title }}</td>
                        <td style="padding: 10px;">{{ invite.expires_at }}</td>
                        <td style="padding: 10px;">{{ "Accepted" if invite.accepted_at else "Pending" }}</td>
                        <td style="padding: 10px;">
                            <code style="word-break: break-all;">
                                {{ url_for('teams.accept_invite_token', token=invite.token, _external=True) }}
                            </code>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="glass-card" style="padding: 12px; color: var(--text-muted);">No invites yet.</div>
        {% endif %}
    </div>
</div>
{% endblock %}
