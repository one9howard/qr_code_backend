{% extends "base.html" %}
{% block body_class %}submit bg-image-dark{% endblock %}
{% block content %}

<!-- Load Page-Specific CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/submit.css') }}">

<div class="submit-container" style="margin-top: 2rem; position: relative;">

    <!-- Form Section -->
    <div class="form-container">
        {% with messages = get_flashed_messages(with_categories=true) %}

        <!-- Standard Flash Messages -->
        {% if messages %}
        {% for category, message in messages %}
        {% if 'add a property' not in message.lower() %}
        <div class="flash-message {{ category }}" style="padding: 0.75rem; margin-bottom: 1rem; border-radius: 4px; 
            {% if category == 'error' %}
                background: rgba(220, 38, 38, 0.1); color: #ef4444; border: 1px solid rgba(220, 38, 38, 0.2);
            {% elif category == 'warning' %}
                background: rgba(234, 179, 8, 0.1); color: #eab308; border: 1px solid rgba(234, 179, 8, 0.2);
            {% else %}
                background: rgba(34, 197, 94, 0.1); color: #22c55e; border: 1px solid rgba(34, 197, 94, 0.2);
            {% endif %}">
            {{ message }}
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}

        <!-- Header with Optional Upgrade Link & Warning -->
        <div style="position: relative; text-align: center; margin-bottom: 2rem;">

            <!-- Absolute Top Right Upgrade Link -->
            {% if messages %}
            {% for category, message in messages %}
            {% if 'add a property' in message.lower() %}
            <a href="{{ url_for('billing.index') }}"
                style="position: absolute; top: 0; right: 0; color: #2196f3; text-decoration: none; font-weight: 600; font-size: 0.9rem;">
                Upgrade to Pro
            </a>
            {% endif %}
            {% endfor %}
            {% endif %}

            <h2 style="margin: 0; display: inline-block;">Property Details</h2>

            {% if messages %}
            {% for category, message in messages %}
            {% if 'add a property' in message.lower() %}
            <div
                style="color: #F59E0B; font-weight: 600; font-size: 0.9rem; margin-top: 8px; display: flex; align-items: center; justify-content: center; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L1 21h22L12 2zm0 3.516L20.297 19H3.703L12 5.516zM11 10v4h2v-4h-2zm0 6v2h2v-2h-2z" />
                </svg>
                {{ message }}
            </div>
            {% endif %}
            {% endfor %}
            {% endif %}
        </div>
        {% endwith %}
        <form method="POST" class="form" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input name="agent_name" placeholder="Agent Name" value="{{ agent_data.name if agent_data else '' }}"
                required>
            <input name="brokerage" placeholder="Brokerage" value="{{ agent_data.brokerage or '' }}" required>
            <input type="tel" name="phone" placeholder="Phone Number" value="{{ agent_data.phone or '' }}" required>
            <input type="email" name="email" placeholder="Email Address"
                value="{{ agent_data.email if agent_data else current_user.email if current_user.is_authenticated else '' }}"
                required>

            <label style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block;">Agent Headshot
                (Optional)</label>
            {% if agent_data and agent_data.photo_filename %}
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <img src="{{ get_storage_url(agent_data.photo_filename) }}"
                    style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                <span style="font-size: 0.8rem; color: #666;">Current headshot being used. Upload new one to
                    replace.</span>
            </div>
            {% endif %}
            <input type="file" name="agent_photo" accept="image/*" style="padding: 10px;">

            <hr style="margin: 1.5rem 0; opacity: 0.1;">

            <input name="address" placeholder="Property Address" required>

            <div style="display: flex; gap: 10px;">
                <input name="beds" placeholder="Beds (e.g. 3)" required style="flex: 1;">
                <input name="baths" placeholder="Baths (e.g. 2.5)" required style="flex: 1;">
            </div>

            <div style="display: flex; gap: 10px;">
                <input name="sqft" placeholder="Square Footage (Optional)" style="flex: 1;">
                <input name="price" placeholder="Asking Price (Optional)" style="flex: 1;">
            </div>

            <label style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block;">Property Photos
                (Optional)</label>
            <input type="file" name="property_photos" accept="image/*" multiple style="padding: 10px;">

            <textarea name="description" placeholder="Property Description (Optional)" rows="4"></textarea>

            <hr style="margin: 1.5rem 0; opacity: 0.1;">

            <!-- Sign Customization Options (NEW) -->
            <h3 style="color: #2196f3; margin-bottom: 1rem;">Sign Options</h3>

            <div class="sign-options-container">
                <!-- Color Palette -->
                <label style="color: #666; font-size: 0.9rem; margin-bottom: 10px; display: block;">Banner Color</label>
                <div class="color-palette">
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#1F6FEB" checked>
                        <div class="color-swatch" style="background: #1F6FEB;"></div>
                        <span class="color-label">Ocean Blue</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#2EA043">
                        <div class="color-swatch" style="background: #2EA043;"></div>
                        <span class="color-label">Forest Green</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#CF222E">
                        <div class="color-swatch" style="background: #CF222E;"></div>
                        <span class="color-label">Ruby Red</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#8250DF">
                        <div class="color-swatch" style="background: #8250DF;"></div>
                        <span class="color-label">Royal Purple</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#FB8500">
                        <div class="color-swatch" style="background: #FB8500;"></div>
                        <span class="color-label">Sunset Orange</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#0969DA">
                        <div class="color-swatch" style="background: #0969DA;"></div>
                        <span class="color-label">Sky Teal</span>
                    </label>
                </div>

                <!-- Material Selector (New for Phase 1) -->
                <label
                    style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block; margin-top: 15px;">Material</label>
                <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="material" value="coroplast_4mm" checked>
                        <span style="font-size: 0.95rem;">Coroplast (4mm)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="material" value="aluminum_040">
                        <span style="font-size: 0.95rem;">Aluminum (.04)</span>
                    </label>
                </div>

                <!-- Size Selector -->
                <label style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block;">Sign Size</label>
                <select name="sign_size" class="size-selector">
                    <option value="12x18">12" × 18" (Small)</option>
                    <option value="18x24" selected>18" × 24" (Standard)</option>
                    <option value="24x36">24" × 36" (Large)</option>
                    <option value="36x18">36" × 18" (Wide)</option>
                    <option value="36x24">36" × 24" (Aluminum Only)</option>
                </select>
            </div>

            <button class="glass-button accent generate-btn">Generate Sign</button>
        </form>
    </div>
</div>

<!-- Load Page-Specific JS -->
<script src="{{ url_for('static', filename='js/submit.js') }}"></script>
{% endblock %}