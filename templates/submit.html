{% extends "base.html" %}
{% block title %}Create Listing | InSite Signs{% endblock %}
{% block body_class %}bg-image-dark{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/submit.css') }}">

<div class="submit-container" style="max-width: 800px; margin: 40px auto; padding: 0 20px;">

    <!-- Page Header -->
    <div style="text-align: center; margin-bottom: 30px;">
        <h1 class="section-header" style="margin-bottom: 8px;">
            {% if is_property_only %}Create Property (Free){% else %}Create New Listing{% endif %}
        </h1>
        <p class="section-subheader">
            {% if is_property_only %}Add property details to assign your SmartSign.{% else %}Enter property details to
            generate your sign preview.{% endif %}
        </p>
    </div>

    <!-- Form Section -->
    <div class="card card--dark">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div style="margin-bottom: 24px;">
            {% for category, message in messages %}
            {% if 'add a property' not in message.lower() %}
            <div class="glass-toast"
                style="position: static; transform: none; margin-bottom: 10px; width: auto; max-width: none;">
                <span style="font-size: 1.2rem; margin-right: 10px;">
                    {% if category == 'error' %}⚠️{% elif category == 'warning' %}⚡{% else %}✅{% endif %}
                </span>
                {{ message }}
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <form method="POST" class="form-grid" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            {% if is_property_only %}
            <input type="hidden" name="mode" value="property_only">
            {% endif %}

            <!-- Section 1: Agent Identity -->
            <div style="margin-bottom: 32px;">
                <h3
                    style="color: var(--accent-blue); margin-bottom: 16px; font-size: 1.1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                    1. Agent Identity
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="input-group">
                        <label class="input-label">Agent Name</label>
                        <input name="agent_name" class="glass-input" placeholder="Full Name"
                            value="{{ agent_data.name if agent_data else '' }}" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Brokerage</label>
                        <input name="brokerage" class="glass-input" placeholder="Brokerage Name"
                            value="{{ agent_data.brokerage or '' }}" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="input-group">
                        <label class="input-label">Phone</label>
                        <input type="tel" name="phone" class="glass-input" placeholder="(555) 555-5555"
                            value="{{ agent_data.phone or '' }}" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Email</label>
                        <input type="email" name="email" class="glass-input" placeholder="agent@example.com"
                            value="{{ agent_data.email if agent_data else current_user.email if current_user.is_authenticated else '' }}"
                            required>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">Tour Scheduling Link (Optional)</label>
                    <input type="url" name="scheduling_url" class="glass-input"
                        placeholder="https://calendly.com/yourname/showings"
                        value="{{ agent_data.scheduling_url if agent_data and agent_data.scheduling_url else '' }}">
                </div>

                <div class="input-group">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <label class="input-label" style="margin: 0;">Agent Headshot</label>
                        <label
                            style="font-size: 0.85rem; color: var(--text-muted); display: flex; align-items: center; gap: 6px; cursor: pointer;">
                            <input type="checkbox" name="include_headshot" value="1" checked> Include on sign
                        </label>
                    </div>
                    {% if agent_data and agent_data.photo_filename %}
                    <div
                        style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <img src="{{ get_storage_url(agent_data.photo_filename) }}"
                            style="width: 48px; height: 48px; border-radius: 50%; object-fit: cover; border: 2px solid white;">
                        <span style="font-size: 0.9rem; color: var(--text-muted);">Current headshot on file. Upload new
                            one to replace.</span>
                    </div>
                    {% endif %}
                    <input type="file" name="agent_photo" accept="image/*" class="glass-input-file">
                </div>

                <div class="input-group" style="margin-top: 20px;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <label class="input-label" style="margin: 0;">Brokerage Logo</label>
                        <label
                            style="font-size: 0.85rem; color: var(--text-muted); display: flex; align-items: center; gap: 6px; cursor: pointer;">
                            <input type="checkbox" name="include_logo" value="1" checked> Include on sign
                        </label>
                    </div>
                    {% if agent_data and agent_data.logo_filename %}
                    <div
                        style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <img src="{{ get_storage_url(agent_data.logo_filename) }}"
                            style="width: 48px; height: 48px; object-fit: contain; background: white; border-radius: 4px; padding: 4px;">
                        <span style="font-size: 0.9rem; color: var(--text-muted);">Current logo on file. Upload new
                            one to replace.</span>
                    </div>
                    {% endif %}
                    <input type="file" name="logo_file" accept="image/*" class="glass-input-file">
                </div>
            </div>

            <!-- Section 2: Property Details -->
            <div style="margin-bottom: 32px;">
                <h3
                    style="color: var(--accent-blue); margin-bottom: 16px; font-size: 1.1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                    2. Property Details
                </h3>

                <div class="input-group" style="margin-bottom: 20px;">
                    <label class="input-label">Property Address</label>
                    <input name="address" class="glass-input" placeholder="123 Main St, City, State" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div class="input-group">
                        <label class="input-label">Beds</label>
                        <input name="beds" class="glass-input" placeholder="e.g. 3" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Baths</label>
                        <input name="baths" class="glass-input" placeholder="e.g. 2.5" required>
                    </div>
                    <div class="input-group" style="grid-column: span 2;">
                        <label class="input-label">Price (Optional)</label>
                        <input name="price" class="glass-input" placeholder="$XXX,XXX">
                    </div>
                </div>

                <div class="input-group" style="margin-bottom: 20px;">
                    <label class="input-label">Property Photos (Optional)</label>
                    <input type="file" name="property_photos" accept="image/*" multiple class="glass-input-file">
                    <p style="margin-top: 6px; font-size: 0.8rem; color: var(--text-muted);">Used for feature sheets and
                        listing pages.</p>
                </div>

                <div class="input-group" style="margin-bottom: 20px;">
                    <label class="input-label">Virtual Tour Link (Optional)</label>
                    <input type="url" name="virtual_tour_url" class="glass-input"
                        placeholder="https://my.matterport.com/show/...">
                </div>
            </div>

            <!-- Section 3: Sign Configuration -->
            {% if not is_property_only %}
            <div style="margin-bottom: 32px;">
                <h3
                    style="color: var(--accent-cyan); margin-bottom: 16px; font-size: 1.1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;">
                    3. Sign Configuration
                </h3>

                <div class="input-group" style="margin-bottom: 24px;">
                    <label class="input-label" style="margin-bottom: 12px;">Sign Layout</label>
                    <div class="layout-grid">
                        <!-- Option 1 -->
                        <label class="layout-card">
                            <input type="radio" name="layout_id" value="smart_v1_photo_banner" checked>
                            <div class="preview-box">
                                <div class="mini-sign banner-style">
                                    <div class="mini-content">
                                        <div class="mini-details">
                                            <div class="line"></div>
                                            <div class="line short"></div>
                                        </div>
                                        <div class="mini-qr"></div>
                                    </div>
                                    <div class="mini-banner">
                                        <div class="mini-photo"></div>
                                    </div>
                                </div>
                            </div>
                            <span class="layout-name">Photo Banner</span>
                            <span class="layout-desc">Professional bottom banner with headshot.</span>
                        </label>

                        <!-- Option 2 -->
                        <label class="layout-card">
                            <input type="radio" name="layout_id" value="smart_v1_minimal">
                            <div class="preview-box">
                                <div class="mini-sign minimal-style">
                                    <div class="mini-content centered">
                                        <div class="mini-qr large"></div>
                                        <div class="line"></div>
                                        <div class="line short"></div>
                                    </div>
                                </div>
                            </div>
                            <span class="layout-name">Modern Minimal</span>
                            <span class="layout-desc">Clean white, focus on QR code.</span>
                        </label>

                        <!-- Option 3 -->
                        <label class="layout-card">
                            <input type="radio" name="layout_id" value="smart_v1_agent_brand">
                            <div class="preview-box">
                                <div class="mini-sign brand-style">
                                    <div class="mini-content centered">
                                        <div class="mini-logo">LOGO</div>
                                        <div class="mini-qr"></div>
                                        <div class="line"></div>
                                    </div>
                                </div>
                            </div>
                            <span class="layout-name">Agent Brand</span>
                            <span class="layout-desc">Logo-centric with dark footer.</span>
                        </label>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">Banner Color</label>
                    <div class="color-palette-grid">
                        <label class="color-option-card">
                            <input type="radio" name="sign_color" value="#1F6FEB" checked>
                            <span class="swatch" style="background: #1F6FEB;"></span>
                            <span class="label">Ocean Blue</span>
                        </label>
                        <label class="color-option-card">
                            <input type="radio" name="sign_color" value="#2EA043">
                            <span class="swatch" style="background: #2EA043;"></span>
                            <span class="label">Forest Green</span>
                        </label>
                        <label class="color-option-card">
                            <input type="radio" name="sign_color" value="#CF222E">
                            <span class="swatch" style="background: #CF222E;"></span>
                            <span class="label">Ruby Red</span>
                        </label>
                        <label class="color-option-card">
                            <input type="radio" name="sign_color" value="#FB8500">
                            <span class="swatch" style="background: #FB8500;"></span>
                            <span class="label">Sunset Orange</span>
                        </label>
                        <label class="color-option-card">
                            <input type="radio" name="sign_color" value="#000000">
                            <span class="swatch" style="background: #111; border: 1px solid white;"></span>
                            <span class="label">Midnight</span>
                        </label>
                    </div>
                </div>

                <div class="input-group" style="margin-top: 24px;">
                    <label class="input-label">Sign Size</label>
                    <select name="sign_size" class="glass-input" style="background-color: rgba(0,0,0,0.5);">
                        <option value="18x24" selected>18" × 24" (Standard Yard Sign)</option>
                        <option value="24x36">24" × 36" (Estate Size)</option>
                        <option value="12x18">12" × 18" (Small/Rider)</option>
                    </select>
                </div>
            </div>
            {% endif %}

            <!-- Actions -->
            <div style="margin-top: 40px; text-align: right;">
                <button type="submit" class="glass-button primary"
                    style="width: 100%; justify-content: center; padding: 16px; font-size: 1.1rem; background: var(--accent-blue); border-color: var(--accent-blue);">
                    {% if is_property_only %}Create Property{% else %}Generate Listing & Preview Sign →{% endif %}
                </button>
                {% if not is_property_only %}
                <p style="text-align: center; margin-top: 16px; font-size: 0.85rem; color: var(--text-muted);">
                    Next step: You'll see a preview of your sign before ordering.
                </p>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<style>
    /* Local Styles for Form Elements */
    .input-label {
        display: block;
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        font-weight: 500;
        margin-bottom: 8px;
    }

    .glass-input {
        width: 100%;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        padding: 12px 16px;
        color: white;
        font-size: 1rem;
        transition: all 0.2s;
        box-sizing: border-box;
        font-family: var(--font-main);
    }

    .glass-input:focus {
        outline: none;
        border-color: var(--accent-blue);
        background: rgba(0, 0, 0, 0.5);
        box-shadow: 0 0 0 2px rgba(0, 119, 255, 0.2);
    }

    .glass-input-file {
        width: 100%;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border: 1px dashed rgba(255, 255, 255, 0.2);
        color: var(--text-muted);
        cursor: pointer;
    }

    .color-palette-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 12px;
    }

    .color-option-card {
        position: relative;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 12px;
        text-align: center;
        transition: all 0.2s;
    }

    .color-option-card:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .color-option-card input {
        position: absolute;
        opacity: 0;
    }

    .color-option-card input:checked+.swatch::after {
        content: '✓';
        color: white;
        font-size: 12px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
    }

    .color-option-card input:checked~.label {
        color: white;
        font-weight: 600;
    }

    .color-option-card .swatch {
        display: block;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        margin: 0 auto 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .color-option-card .label {
        display: block;
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    .color-option-card:has(input:checked) {
        border-color: var(--accent-blue);
        background: rgba(0, 119, 255, 0.1);
    }
</style>

<!-- Load Page-Specific JS -->
<script src="{{ url_for('static', filename='js/submit.js') }}"></script>
{% endblock %}