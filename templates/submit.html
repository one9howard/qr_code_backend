{% extends "base.html" %}
{% block body_class %}submit bg-image-dark{% endblock %}
{% block content %}

<!-- Load Page-Specific CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/submit.css') }}">

<div class="submit-container" style="margin-top: 2rem; position: relative;">

    <!-- Form Section -->
    <div class="form-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        {% if 'upgrade' in message.lower() or 'pro' in message.lower() or 'add a property' in message.lower() %}
        <div class="restriction-banner">
            <!-- Background Graphic (CSS Pattern) -->
            <div class="banner-bg"></div>

            <div class="banner-content">
                <div class="feature-badge">
                    You need to add a property first
                </div>
                {% if 'upgrade' in message.lower() or 'pro' in message.lower() %}
                <a href="{{ url_for('billing.index') }}" class="upgrade-link">Upgrade to Pro</a>
                {% endif %}
            </div>
        </div>
        <style>
            .restriction-banner {
                position: relative;
                background: #1e1e24;
                /* Fallback */
                border-radius: 12px;
                overflow: hidden;
                padding: 2.5rem 1rem;
                margin-bottom: 2rem;
                text-align: center;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            }

            .banner-bg {
                position: absolute;
                inset: 0;
                background: linear-gradient(135deg, rgba(103, 58, 183, 0.8), rgba(233, 30, 99, 0.8)),
                    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,160L48,176C96,192,192,224,288,224C384,224,480,192,576,165.3C672,139,768,117,864,128C960,139,1056,181,1152,197.3C1248,213,1344,203,1392,197.3L1440,192V320H1392C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320H0Z"></path></svg>');
                background-size: cover;
                background-position: center;
                filter: blur(0px);
                /* Sharp background */
            }

            .banner-content {
                position: relative;
                z-index: 10;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }

            .feature-badge {
                background: #FFD700;
                /* Gold/Yellow */
                color: #000;
                font-weight: 800;
                padding: 6px 16px;
                border-radius: 4px;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                font-size: 0.9rem;
                box-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
            }

            .upgrade-link {
                color: rgba(255, 255, 255, 0.9);
                text-decoration: underline;
                font-size: 0.85rem;
                cursor: pointer;
                transition: color 0.2s;
            }

            .upgrade-link:hover {
                color: #fff;
            }
        </style>
        {% else %}
        <div class="flash-message {{ category }}" style="padding: 0.75rem; margin-bottom: 1rem; border-radius: 4px; 
            {% if category == 'error' %}
                background: rgba(220, 38, 38, 0.1); color: #ef4444; border: 1px solid rgba(220, 38, 38, 0.2);
            {% elif category == 'warning' %}
                background: rgba(234, 179, 8, 0.1); color: #eab308; border: 1px solid rgba(234, 179, 8, 0.2);
            {% else %}
                background: rgba(34, 197, 94, 0.1); color: #22c55e; border: 1px solid rgba(34, 197, 94, 0.2);
            {% endif %}">
            {{ message }}
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% endwith %}
        <h2>Property Details</h2>
        <form method="POST" class="form" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input name="agent_name" placeholder="Agent Name" value="{{ agent_data.name if agent_data else '' }}"
                required>
            <input name="brokerage" placeholder="Brokerage" value="{{ agent_data.brokerage or '' }}" required>
            <input type="tel" name="phone" placeholder="Phone Number" value="{{ agent_data.phone or '' }}" required>
            <input type="email" name="email" placeholder="Email Address"
                value="{{ agent_data.email if agent_data else current_user.email if current_user.is_authenticated else '' }}"
                required>

            <label style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block;">Agent Headshot
                (Optional)</label>
            {% if agent_data and agent_data.photo_filename %}
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <img src="{{ get_storage_url(agent_data.photo_filename) }}"
                    style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                <span style="font-size: 0.8rem; color: #666;">Current headshot being used. Upload new one to
                    replace.</span>
            </div>
            {% endif %}
            <input type="file" name="agent_photo" accept="image/*" style="padding: 10px;">

            <hr style="margin: 1.5rem 0; opacity: 0.1;">

            <input name="address" placeholder="Property Address" required>

            <div style="display: flex; gap: 10px;">
                <input name="beds" placeholder="Beds (e.g. 3)" required style="flex: 1;">
                <input name="baths" placeholder="Baths (e.g. 2.5)" required style="flex: 1;">
            </div>

            <div style="display: flex; gap: 10px;">
                <input name="sqft" placeholder="Square Footage (Optional)" style="flex: 1;">
                <input name="price" placeholder="Asking Price (Optional)" style="flex: 1;">
            </div>

            <label style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block;">Property Photos
                (Optional)</label>
            <input type="file" name="property_photos" accept="image/*" multiple style="padding: 10px;">

            <textarea name="description" placeholder="Property Description (Optional)" rows="4"></textarea>

            <hr style="margin: 1.5rem 0; opacity: 0.1;">

            <!-- Sign Customization Options (NEW) -->
            <h3 style="color: #2196f3; margin-bottom: 1rem;">Sign Options</h3>

            <div class="sign-options-container">
                <!-- Color Palette -->
                <label style="color: #666; font-size: 0.9rem; margin-bottom: 10px; display: block;">Banner Color</label>
                <div class="color-palette">
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#1F6FEB" checked>
                        <div class="color-swatch" style="background: #1F6FEB;"></div>
                        <span class="color-label">Ocean Blue</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#2EA043">
                        <div class="color-swatch" style="background: #2EA043;"></div>
                        <span class="color-label">Forest Green</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#CF222E">
                        <div class="color-swatch" style="background: #CF222E;"></div>
                        <span class="color-label">Ruby Red</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#8250DF">
                        <div class="color-swatch" style="background: #8250DF;"></div>
                        <span class="color-label">Royal Purple</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#FB8500">
                        <div class="color-swatch" style="background: #FB8500;"></div>
                        <span class="color-label">Sunset Orange</span>
                    </label>
                    <label class="color-option">
                        <input type="radio" name="sign_color" value="#0969DA">
                        <div class="color-swatch" style="background: #0969DA;"></div>
                        <span class="color-label">Sky Teal</span>
                    </label>
                </div>

                <!-- Material Selector (New for Phase 1) -->
                <label
                    style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block; margin-top: 15px;">Material</label>
                <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="material" value="coroplast_4mm" checked>
                        <span style="font-size: 0.95rem;">Coroplast (4mm)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="material" value="aluminum_040">
                        <span style="font-size: 0.95rem;">Aluminum (.04)</span>
                    </label>
                </div>

                <!-- Size Selector -->
                <label style="color: #666; font-size: 0.9rem; margin-bottom: 5px; display: block;">Sign Size</label>
                <select name="sign_size" class="size-selector">
                    <option value="12x18">12" × 18" (Small)</option>
                    <option value="18x24" selected>18" × 24" (Standard)</option>
                    <option value="24x36">24" × 36" (Large)</option>
                    <option value="36x18">36" × 18" (Wide)</option>
                    <option value="36x24">36" × 24" (Aluminum Only)</option>
                </select>
            </div>

            <button class="glass-button accent generate-btn">Generate Sign</button>
        </form>
    </div>
</div>

<!-- Load Page-Specific JS -->
<script src="{{ url_for('static', filename='js/submit.js') }}"></script>
{% endblock %}