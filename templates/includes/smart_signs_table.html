<div id="smart-signs-section" class="card card-smart col-span-12">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div>
            <h3 style="margin: 0; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                üì¶ SmartSigns
            </h3>
            <p style="margin: 4px 0 0 0; font-size: 0.85rem; color: var(--text-muted);">
                Reusable signs with dynamic QR codes.
                {% if not is_pro %}
                <span style="opacity: 0.7;">(Pro required to reassign)</span>
                {% endif %}
            </p>
            <p style="margin: 6px 0 0 0; font-size: 0.75rem; color: var(--accent-cyan); opacity: 0.8;">
                SmartSign scans turn into direct buyer inquiries‚Äîno apps, no downloads.
            </p>
        </div>
        <a href="{{ url_for('smart_signs.order_start') }}" class="glass-button accent">Order SmartSign</a>
    </div>

    <div class="table-container">
        {% if sign_assets %}
        <table class="saas-table">
            <thead>
                <tr>
                    <th>Label</th>
                    <th>Assigned Property</th>
                    <th>Status</th>
                    <th style="text-align: center;">Scans</th>
                    <th style="text-align: center;">Leads</th>
                    <th style="text-align: center;">Conv.</th>
                    <th style="position: sticky; right: 0; background: var(--bg-card); z-index: 1;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for asset in sign_assets %}
                <tr {% if asset.id==highlight_asset_id %}class="highlight-row" {% endif %}>
                    <td>{{ asset.label }}<br><small style="font-family: monospace; color: var(--accent-cyan);">{{
                            asset.code
                            }}</small></td>
                    <td>
                        {% if asset.active_property_id %}
                        <span style="color:var(--accent-green);">‚óè</span> {{ asset.property_address }}
                        {% else %}
                        <span style="color:var(--text-muted);">Unassigned</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if asset.is_frozen %}
                        <span class="badge badge-orange">Frozen</span>
                        {% elif not asset.activated_at %}
                        <span class="badge badge-gray">Pending</span>
                        {% else %}
                        <span class="badge badge-green">Active</span>
                        {% endif %}
                    </td>
                    <td style="text-align: center; font-family: monospace;">{{ asset.scans or 0 }}</td>
                    <td style="text-align: center; font-family: monospace;">{{ asset.leads or 0 }}</td>
                    <td style="text-align: center; font-family: monospace; color: var(--accent-cyan);">
                        {{ asset.conversion or '‚Äî' }}</td>
                    <td style="position: sticky; right: 0; background: var(--bg-card); z-index: 1;">
                        <!-- Case 0: Pending Order (Resume) -->
                        {% if asset.is_pending_order %}
                        <div style="font-size: 0.85rem; margin-bottom: 4px; color: var(--text-orange);">
                            Payment Required
                        </div>
                        <a href="{{ url_for('smart_signs.order_preview', order_id=asset.id) }}"
                            class="glass-button accent" style="padding: 4px 12px; font-size: 0.8rem;">Resume Setup</a>

                        {% else %}

                        <div style="display: flex; gap: 12px; align-items: center;">
                            <!-- Primary Action: Assign or Edit -->
                            {% if not asset.is_frozen %}
                            {% if not asset.active_property_id %}
                            <a href="{{ url_for('smart_signs.edit_smartsign', asset_id=asset.id) }}"
                                class="glass-button accent"
                                style="padding: 6px 12px; font-size: 0.8rem; display: flex; align-items: center; gap: 6px;">
                                <span>+</span> Assign
                            </a>
                            {% else %}
                            <a href="{{ url_for('smart_signs.edit_smartsign', asset_id=asset.id) }}"
                                class="glass-button secondary"
                                style="padding: 6px 12px; font-size: 0.8rem; color: var(--text-muted);">
                                Edit
                            </a>
                            {% endif %}

                            <!-- Secondary Actions: PDF -->
                            <a href="{{ url_for('smart_signs.preview_smartsign', asset_id=asset.id) }}" target="_blank"
                                rel="noopener" title="Preview PDF"
                                style="color: var(--text-muted); display: flex; align-items: center;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                            </a>

                            <!-- Secondary Actions: QR Copy -->
                            <button
                                onclick="copyText('{{ url_for('properties.qr_scan_redirect', code=asset.code, _external=True) }}', this)"
                                title="Copy QR Link"
                                style="background:none; border:none; color: var(--text-muted); padding:0; cursor:pointer; display: flex; align-items: center; transition: color 0.2s;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <path d="M3 14h1v7h6v-1"></path>
                                    <path d="M3 18h2"></path>
                                </svg>
                            </button>
                            {% else %}
                            <span class="text-muted" style="font-size: 0.8rem;">Frozen</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div style="text-align: center; padding: 32px; color: var(--text-muted);">
            No SmartSigns yet.
        </div>
        {% endif %}
    </div>
</div>